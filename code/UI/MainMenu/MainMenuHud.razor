@namespace Sauna.UI
@attribute [StyleSheet]
@inherits PanelComponent

<root>
	@switch ( _screen )
	{
		case MenuScreen.MainMenu:
			<MainMenu HasSaveData="@SaveData.Has" Screen:bind="@_screen"/>
			break;
		case MenuScreen.Credits:
			<Credits Screen:bind="@_screen"/>
			break;
		default:
			throw new ArgumentOutOfRangeException();
	}
</root>

@code {
	public enum MenuScreen
	{
		MainMenu,
		Credits
	}

	public static float Volume { get; set; } = 0.025f;
	public static (PlayerSave Save, bool Has) SaveData { get; private set; }

	(SoundFile start, SoundFile loop) sounds;

	SoundHandle _loopStart;
	SoundHandle _loop;

	RealTimeUntil _playLoop = 999;

	private MenuScreen _screen;

	public async void Initialize()
	{
		SaveData = Player.GetSave();

		// Start music.
		sounds.start = SoundFile.Load( "sounds/music/zakkujo-ero_vaimosta-loop_start.sound" );
		await sounds.start.LoadAsync();

		sounds.loop = SoundFile.Load( "sounds/music/zakkujo-ero_vaimosta-loop.sound" );
		await sounds.loop.LoadAsync();

		_loopStart = Sound.PlayFile( sounds.start );
		_loopStart.ListenLocal = true;
		_loopStart.Volume = Volume;
		_playLoop = sounds.start.Duration;
	}

	protected override void OnUpdate()
	{
		if ( _playLoop && _loop == null && sounds.loop != null )
		{
			_loop = Sound.PlayFile( sounds.loop );
			_loop.ListenLocal = true;
			_loop.Volume = Volume;
		}
	}

	protected override int BuildHash()
	{
		return HashCode.Combine( SaveData, _screen );
	}

}
