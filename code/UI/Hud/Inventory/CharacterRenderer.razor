@namespace Sauna.UI
@attribute [StyleSheet]
@inherits Panel

<root>
	<ScenePanel class="scene" @ref=_scene />
</root>

@code {
	private ScenePanel _scene;
	private SceneModel _character;
	private float _yaw = 170f;

	protected override void OnAfterTreeRender(bool firstTime)
	{
		if (!firstTime)
			return;

		var sceneWorld = new SceneWorld();
		var directionalLight = new SceneDirectionalLight( sceneWorld, Rotation.Identity, Color.White );
		_character = new SceneModel( sceneWorld, "models/guy/guy.vmdl", new Transform(Vector3.Zero, Rotation.From(0, _yaw, 0)) );
		_scene.World = sceneWorld;
		_scene.Camera.Position = new Vector3(-40, 0, 35);
	}

	public override void OnButtonEvent( ButtonEvent e )
	{
		if ( e.Button == "mouseleft" )
			SetMouseCapture( e.Pressed );

		base.OnButtonEvent( e );
	}
	
	public override void Tick() 
	{
		if (_character is null)
			return;

		if ( HasMouseCapture )
			_yaw -= Mouse.Delta.x * 0.05f;

		_character.Update(RealTime.Delta);
		_character.Rotation = Rotation.From(0, _yaw, 0);
	}
}
